(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(t){if(t.ep)return;t.ep=!0;const o=r(t);fetch(t.href,o)}})();const L="https://api.github.com/search/repositories",S=800,_="selectedRepos";function I(e,n){let r;return(...s)=>{clearTimeout(r),r=setTimeout(()=>e(...s),n)}}let d=null,h=0;async function v(e){if(!e)return[];d&&d.abort(),d=new AbortController,h+=1;const n=h;try{const r=`${L}?q=${encodeURIComponent(e)}&per_page=5`,s=await fetch(r,{headers:{Accept:"application/vnd.github.v3+json"},signal:d.signal});if(s.status===403)throw new Error("RATE_LIMIT");if(s.status===422)throw new Error("INVALID_REQUEST");if(s.status>=500)throw new Error("SERVER_ERROR");if(!s.ok)throw new Error(`HTTP_ERROR_${s.status}`);const t=await s.json();return n!==h?[]:Array.isArray(t.items)?t.items:[]}catch(r){if(r.name==="AbortError")return[];throw r}}function A(){try{const e=localStorage.getItem(_);if(!e)return[];const n=JSON.parse(e);return Array.isArray(n)?n:[]}catch(e){return console.warn("Ошибка загрузки из localStorage:",e),[]}}function R(e){try{if(!Array.isArray(e)){console.warn("saveSelected: ожидался массив, получено:",typeof e);return}localStorage.setItem(_,JSON.stringify(e))}catch(n){console.warn("Ошибка сохранения в localStorage:",n)}}let a=[];function C(){return a=A(),a.length}function b(){return[...a]}function w(e){return a.some(n=>n.full_name===e.full_name)}function N(e){if(w(e))return!1;const n={id:e.id,name:e.name,full_name:e.full_name,html_url:e.html_url,stargazers_count:e.stargazers_count,ownerName:e.owner.login};return a.push(n),R(a),!0}function T(e){return e<0||e>=a.length?!1:(a.splice(e,1),R(a),!0)}function O(e,n,r){e.innerHTML="",n.length&&n.forEach(s=>{const t=document.createElement("li");t.textContent=s.full_name,t.tabIndex=0,t.className="autocomplete-item",w(s)?(t.classList.add("autocomplete-item--added"),t.title="Уже добавлено",t.style.background="#e0ffe0",t.style.cursor="not-allowed"):(t.addEventListener("click",()=>{r(s)}),t.addEventListener("keydown",c=>{c.key==="Enter"&&t.click()})),e.appendChild(t)})}function M(e,n,r){e.innerHTML="",n.forEach((s,t)=>{const o=document.createElement("li");o.className="results-item",o.dataset.idx=t;const c=document.createElement("div");c.className="results-item__info";const u=document.createElement("a");u.href=s.html_url,u.target="_blank",u.rel="noopener noreferrer",u.textContent=s.name,u.className="results-item__link";const f=document.createElement("span");f.textContent=` by ${s.ownerName}`,f.className="results-item__owner";const p=document.createElement("span");p.textContent=` ★ ${s.stargazers_count}`,p.className="results-item__stars",c.appendChild(u),c.appendChild(f),c.appendChild(p);const i=document.createElement("button");i.textContent="✕",i.className="results-item__remove",i.title="Удалить",i.type="button",i.dataset.idx=t,i.addEventListener("click",()=>{r(t)}),o.appendChild(c),o.appendChild(i),e.appendChild(o)})}function y(e,n){if(e.innerHTML="",!n)return;const r=document.createElement("li");r.textContent=n,r.className="autocomplete-item autocomplete-status",r.style.cursor="default",e.appendChild(r)}function g(e){e.innerHTML=""}const m=document.getElementById("search"),l=document.getElementById("suggestions"),k=document.getElementById("results");async function H(e){if(e.trim().length<=2){g(l);return}try{y(l,"Ищем…");const n=await v(e);O(l,n,x)}catch(n){let r="Ошибка сети или запроса";n.message==="RATE_LIMIT"?r="Слишком много запросов (rate limit)":n.message==="INVALID_REQUEST"?r="Некорректный запрос (422)":n.message==="SERVER_ERROR"&&(r="Ошибка сервера GitHub (5xx)"),y(l,r)}}function x(e){N(e)&&(m.value="",g(l),m.focus(),E())}function B(e){T(e)&&E()}function E(){const e=b();M(k,e,B)}function z(e){!m.contains(e.target)&&!l.contains(e.target)&&g(l)}const D=I(H,S);function P(){C(),E(),m.addEventListener("input",e=>{D(e.target.value)}),document.addEventListener("click",z)}document.addEventListener("DOMContentLoaded",P);
