(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function r(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(t){if(t.ep)return;t.ep=!0;const s=r(t);fetch(t.href,s)}})();const S="https://api.github.com/search/repositories",C=800,R="selectedRepos";function I(e,n){let r;return(...o)=>{clearTimeout(r),r=setTimeout(()=>e(...o),n)}}let f=null,g=0;async function v(e){if(!e)return[];f&&f.abort(),f=new AbortController,g+=1;const n=g;try{const r=`${S}?q=${encodeURIComponent(e)}&per_page=5`,o=await fetch(r,{headers:{Accept:"application/vnd.github.v3+json"},signal:f.signal});if(o.status===403)throw new Error("RATE_LIMIT");if(o.status===422)throw new Error("INVALID_REQUEST");if(o.status>=500)throw new Error("SERVER_ERROR");if(!o.ok)throw new Error(`HTTP_ERROR_${o.status}`);const t=await o.json();return n!==g?[]:Array.isArray(t.items)?t.items:[]}catch(r){if(r.name==="AbortError")return[];throw r}}function A(){try{const e=localStorage.getItem(R);if(!e)return[];const n=JSON.parse(e);return Array.isArray(n)?n:[]}catch(e){return console.warn("Ошибка загрузки из localStorage:",e),[]}}function w(e){try{if(!Array.isArray(e)){console.warn("saveSelected: ожидался массив, получено:",typeof e);return}localStorage.setItem(R,JSON.stringify(e))}catch(n){console.warn("Ошибка сохранения в localStorage:",n)}}let a=[];function b(){return a=A(),a.length}function N(){return[...a]}function L(e){return a.some(n=>n.full_name===e.full_name)}function T(e){if(L(e))return!1;const n={id:e.id,name:e.name,full_name:e.full_name,html_url:e.html_url,stargazers_count:e.stargazers_count,ownerName:e.owner.login,ownerUrl:e.owner.html_url};return a.push(n),w(a),!0}function O(e){return e<0||e>=a.length?!1:(a.splice(e,1),w(a),!0)}function k(e,n,r){e.innerHTML="",n.length&&n.forEach(o=>{const t=document.createElement("li");t.textContent=o.full_name,t.tabIndex=0,t.className="autocomplete-item",L(o)?(t.classList.add("autocomplete-item--added"),t.title="Уже добавлено",t.style.background="#e0ffe0",t.style.cursor="not-allowed"):(t.addEventListener("click",()=>{r(o)}),t.addEventListener("keydown",c=>{c.key==="Enter"&&t.click()})),e.appendChild(t)})}function M(e,n,r){e.innerHTML="",n.forEach((o,t)=>{const s=document.createElement("li");s.className="results-item",s.dataset.idx=t;const c=document.createElement("div");c.className="results-item__info";const u=document.createElement("a");u.href=o.html_url,u.target="_blank",u.rel="noopener noreferrer",u.textContent=o.name,u.className="results-item__link";const m=document.createElement("span");m.textContent=" by ",m.className="results-item__owner";const d=document.createElement("a");d.href=o.ownerUrl,d.target="_blank",d.rel="noopener noreferrer",d.textContent=o.ownerName,d.className="results-item__link";const h=document.createElement("span");h.textContent=` ★ ${o.stargazers_count}`,h.className="results-item__stars",c.appendChild(u),c.appendChild(m),m.appendChild(d),c.appendChild(h);const i=document.createElement("button");i.textContent="✕",i.className="results-item__remove",i.title="Удалить",i.type="button",i.dataset.idx=t,i.addEventListener("click",()=>{r(t)}),s.appendChild(c),s.appendChild(i),e.appendChild(s)})}function y(e,n){if(e.innerHTML="",!n)return;const r=document.createElement("li");r.textContent=n,r.className="autocomplete-item autocomplete-status",r.style.cursor="default",e.appendChild(r)}function E(e){e.innerHTML=""}const p=document.getElementById("search"),l=document.getElementById("suggestions"),x=document.getElementById("results");async function H(e){if(e.trim().length<=2){E(l);return}try{y(l,"Ищем…");const n=await v(e);k(l,n,U)}catch(n){let r="Ошибка сети или запроса";n.message==="RATE_LIMIT"?r="Слишком много запросов (rate limit)":n.message==="INVALID_REQUEST"?r="Некорректный запрос (422)":n.message==="SERVER_ERROR"&&(r="Ошибка сервера GitHub (5xx)"),y(l,r)}}function U(e){T(e)&&(p.value="",E(l),p.focus(),_())}function B(e){O(e)&&_()}function _(){const e=N();M(x,e,B)}function z(e){!p.contains(e.target)&&!l.contains(e.target)&&E(l)}const D=I(H,C);function P(){b(),_(),p.addEventListener("input",e=>{D(e.target.value)}),document.addEventListener("click",z)}document.addEventListener("DOMContentLoaded",P);
